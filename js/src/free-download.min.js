const getParameterByName=(name,url=window.location.href)=>{name=name.replace(/[\[\]]/g,'\\$&');var regex=new RegExp('[?&]'+name+'(=([^&#]*)|&|#|$)'),results=regex.exec(url);if(!results)return null;if(!results[2])return '';return decodeURIComponent(results[2].replace(/\+/g,' '));}
const downloadURI=(url)=>{const link=document.createElement('a')
link.href=url
document.body.appendChild(link)
link.click()
document.body.removeChild(link)
delete link}
const countDown=(element,value,url)=>{const int=setInterval(()=>{element.innerHTML=value
value--||clearInterval(int)},1000)
setTimeout(()=>{downloadURI(url)},value*1000)}
const counterElement=document.getElementById('counter')
const messageElement=document.getElementById('message')
const bannerElement=document.getElementsByClassName('banner-dark-hex')[0]
const download=()=>{const email=getParameterByName('e')
const hash=getParameterByName('h')
const xhr=new XMLHttpRequest()
xhr.open('POST','https://api.coreui.io/free/download.php',true)
xhr.onreadystatechange=()=>{if(xhr.readyState===XMLHttpRequest.DONE){const status=xhr.status;if(status===0||(status>=200&&status<400)){const res=JSON.parse(xhr.responseText)
if(res.status==='ok'){bannerElement.style.opacity="1"
countDown(counterElement,20,res.url)}else{bannerElement.remove()
createAlert(messageElement,'danger',res.message)}}else{bannerElement.remove()
createAlert(messageElement,'danger','Something went wrong, please try one more time')}}}
xhr.send(JSON.stringify({'email':email,'hash':hash}))}
window.onload=()=>{download()}
const createAlert=(target,type,message)=>{Array.from(target.getElementsByClassName('alert')).forEach(element=>element.remove())
const alert=document.createElement('div')
alert.classList.add('alert',`alert-${type}`)
alert.innerHTML=message
if(type==='success'){target.innerHTML=''}
target.appendChild(alert)}